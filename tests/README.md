# Tests for sglang_iterm2_utils

è¿™ä¸ªç›®å½•åŒ…å«äº† `sglang_iterm2_utils` åŒ…çš„æ‰€æœ‰å•å…ƒæµ‹è¯•ã€‚

## æµ‹è¯•æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ __init__.py                           # æµ‹è¯•åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”œâ”€â”€ test_sglang_iterm2_utils.py          # åŒ…çš„æ•´ä½“é›†æˆæµ‹è¯•
â”œâ”€â”€ test_ssh_connections.py              # SSHè¿æ¥åŠŸèƒ½çš„ä¸“é—¨æµ‹è¯•
â”œâ”€â”€ test_session_management.py           # ä¼šè¯ç®¡ç†åŠŸèƒ½çš„ä¸“é—¨æµ‹è¯•
â”œâ”€â”€ test_multi_node_init.py              # å¤šèŠ‚ç‚¹åˆå§‹åŒ–åŠŸèƒ½çš„ä¸“é—¨æµ‹è¯•
â”œâ”€â”€ test_append_python_path_pytest.py    # Pythonè·¯å¾„è¿½åŠ åŠŸèƒ½çš„ä¸“é—¨æµ‹è¯•
â””â”€â”€ README.md                            # æµ‹è¯•æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## æµ‹è¯•è¦†ç›–èŒƒå›´

### ğŸ“¡ SSHè¿æ¥æµ‹è¯• (`test_ssh_connections.py`)
- âœ… å‡½æ•°å­˜åœ¨æ€§å’Œç­¾åéªŒè¯
- âœ… æ— çª—å£/æ ‡ç­¾é¡µ/ä¼šè¯çš„è¾¹ç¼˜æƒ…å†µ
- âœ… å•ä¸ªå’Œå¤šä¸ªä¸»æœºè¿æ¥
- âœ… ä¸»æœºå¾ªç¯åˆ†é…é€»è¾‘
- âœ… ä¸åŒç”¨æˆ·åå’Œä¸»æœºæ ¼å¼
- âœ… å¼‚å¸¸å¤„ç†æµ‹è¯•
- âœ… å‚æ•°éªŒè¯
- **æµ‹è¯•æ•°é‡ï¼š18ä¸ª**

### ğŸ”„ ä¼šè¯ç®¡ç†æµ‹è¯• (`test_session_management.py`)
- âœ… å‡½æ•°å­˜åœ¨æ€§å’Œç­¾åéªŒè¯
- âœ… æ— çª—å£/æ ‡ç­¾é¡µçš„è¾¹ç¼˜æƒ…å†µ
- âœ… ç©ºä¼šè¯åˆ—è¡¨å¤„ç†
- âœ… å•ä¸ªå’Œå¤šä¸ªä¼šè¯é‡å¯
- âœ… å¼‚å¸¸å¤„ç†æµ‹è¯•
- âœ… æ··åˆä¼šè¯çŠ¶æ€æµ‹è¯•
- âœ… è¿æ¥å‚æ•°ä½¿ç”¨éªŒè¯
- **æµ‹è¯•æ•°é‡ï¼š13ä¸ª**

### ğŸš€ å¤šèŠ‚ç‚¹åˆå§‹åŒ–æµ‹è¯• (`test_multi_node_init.py`)
- âœ… å‡½æ•°å­˜åœ¨æ€§å’Œç­¾åéªŒè¯
- âœ… æ— çª—å£/æ ‡ç­¾é¡µ/ä¼šè¯çš„è¾¹ç¼˜æƒ…å†µ
- âœ… å•ä¼šè¯å’Œå¤šä¼šè¯åˆå§‹åŒ–
- âœ… IPåœ°å€æ£€æµ‹å’Œè§£æ
- âœ… ç¯å¢ƒå˜é‡è®¾ç½®éªŒè¯
- âœ… å¼‚å¸¸å¤„ç†æµ‹è¯•
- âœ… å·¥å…·å‡½æ•°å•å…ƒæµ‹è¯•
- **æµ‹è¯•æ•°é‡ï¼š20ä¸ª**

### ğŸ Pythonè·¯å¾„è¿½åŠ æµ‹è¯• (`test_append_python_path_pytest.py`)
- âœ… å‡½æ•°å­˜åœ¨æ€§å’Œç­¾åéªŒè¯
- âœ… æ— çª—å£/æ ‡ç­¾é¡µ/ä¼šè¯çš„è¾¹ç¼˜æƒ…å†µ
- âœ… å¤šè·¯å¾„å’Œå¤šä¼šè¯å¤„ç†
- âœ… ç©ºè·¯å¾„åˆ—è¡¨å¤„ç†
- âœ… å‘½ä»¤æ ¼å¼éªŒè¯
- âœ… å¼‚å¸¸å¤„ç†æµ‹è¯•
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- **æµ‹è¯•æ•°é‡ï¼š8ä¸ª**

### ğŸ”— æ•´ä½“é›†æˆæµ‹è¯• (`test_sglang_iterm2_utils.py`)
- âœ… åŒ…å¯¼å…¥å’Œå…ƒæ•°æ®éªŒè¯
- âœ… å‡½æ•°å¯è®¿é—®æ€§æµ‹è¯•
- âœ… åŸºæœ¬åŠŸèƒ½é›†æˆæµ‹è¯•
- **æµ‹è¯•æ•°é‡ï¼š13ä¸ª**

## è¿è¡Œæµ‹è¯•

### ä½¿ç”¨Makeå‘½ä»¤ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œè¯¦ç»†è¾“å‡ºçš„æµ‹è¯•
make test-verbose

# åªè¿è¡ŒSSHè¿æ¥æµ‹è¯•
make test-ssh

# åªè¿è¡Œä¼šè¯ç®¡ç†æµ‹è¯•
make test-session

# åªè¿è¡Œå¤šèŠ‚ç‚¹åˆå§‹åŒ–æµ‹è¯•
make test-multi-node

# åªè¿è¡ŒPythonè·¯å¾„è¿½åŠ æµ‹è¯•
make test-append-python-path

# è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
make test-all
```

### ä½¿ç”¨pytestç›´æ¥è¿è¡Œ

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python3 -m pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
python3 -m pytest tests/test_ssh_connections.py -v
python3 -m pytest tests/test_session_management.py -v
python3 -m pytest tests/test_multi_node_init.py -v
python3 -m pytest tests/test_append_python_path_pytest.py -v
python3 -m pytest tests/test_sglang_iterm2_utils.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
python3 -m pytest tests/test_ssh_connections.py::TestSSHConnections::test_connect_remote_machines_success -v
```

### ä½¿ç”¨å†…ç½®æµ‹è¯•è¿è¡Œå™¨

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
python3 tests/test_ssh_connections.py
python3 tests/test_session_management.py
python3 tests/test_multi_node_init.py
python3 tests/test_sglang_iterm2_utils.py
# æ³¨æ„ï¼štest_append_python_path_pytest.py éœ€è¦ä½¿ç”¨ pytest è¿è¡Œ
```

## æµ‹è¯•ç»Ÿè®¡

- **æ€»æµ‹è¯•æ•°é‡ï¼š72ä¸ª** (18+13+20+8+13)
- **æµ‹è¯•è¦†ç›–æ¨¡å—ï¼š5ä¸ª**
- **æµ‹è¯•é€šè¿‡ç‡ï¼š100%**
- **ä¸»è¦åŠŸèƒ½è¦†ç›–ï¼š**
  - SSHè¿æ¥ç®¡ç† âœ…
  - ä¼šè¯é‡å¯ç®¡ç† âœ…
  - å¤šèŠ‚ç‚¹åˆå§‹åŒ– âœ…
  - Pythonè·¯å¾„ç®¡ç† âœ…
  - é”™è¯¯å¤„ç† âœ…
  - è¾¹ç¼˜æƒ…å†µå¤„ç† âœ…
  - å‚æ•°éªŒè¯ âœ…

## æµ‹è¯•è®¾è®¡åŸåˆ™

### ğŸ¯ å…¨é¢è¦†ç›–
- æ­£å¸¸æµç¨‹æµ‹è¯•
- è¾¹ç¼˜æƒ…å†µæµ‹è¯•
- å¼‚å¸¸å¤„ï¿½ï¿½ï¿½æµ‹è¯•
- å‚æ•°éªŒè¯æµ‹è¯•

### ğŸ—ï¸ æ¨¡å—åŒ–è®¾è®¡
- æ¯ä¸ªæ¨¡å—æœ‰ä¸“é—¨çš„æµ‹è¯•æ–‡ä»¶
- æ¸…æ™°çš„æµ‹è¯•ç±»åˆ«åˆ†ç¦»
- å¯ç‹¬ç«‹è¿è¡Œçš„æµ‹è¯•å¥—ä»¶

### ğŸ” Mockç­–ç•¥
- ä½¿ç”¨ `unittest.mock` è¿›è¡Œä¾èµ–éš”ç¦»
- æ¨¡æ‹ŸiTerm2 APIè°ƒç”¨
- éªŒè¯å‡½æ•°è°ƒç”¨å‚æ•°å’Œæ¬¡æ•°

### ğŸ“Š å¼‚æ­¥æµ‹è¯•æ”¯æŒ
- ä¸“é—¨çš„å¼‚æ­¥æµ‹è¯•ç±»
- åç¨‹å‡½æ•°æµ‹è¯•
- å¼‚æ­¥æ“ä½œéªŒè¯

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. **é€‰æ‹©åˆé€‚çš„æµ‹è¯•æ–‡ä»¶**ï¼š
   - SSHç›¸å…³åŠŸèƒ½ â†’ `test_ssh_connections.py`
   - ä¼šè¯ç®¡ç†ç›¸å…³ â†’ `test_session_management.py`
   - åŒ…çº§åˆ«åŠŸèƒ½ â†’ `test_sglang_iterm2_utils.py`

2. **éµå¾ªå‘½åçº¦å®š**ï¼š
   - æµ‹è¯•ç±»ï¼š`TestModuleName`
   - æµ‹è¯•æ–¹æ³•ï¼š`test_function_name_scenario`

3. **ä½¿ç”¨æ ‡å‡†æµ‹è¯•ç»“æ„**ï¼š
   ```python
   async def test_function_name_scenario(self):
       """Test description"""
       # Arrange - è®¾ç½®æµ‹è¯•æ•°æ®
       # Act - æ‰§è¡Œè¢«æµ‹è¯•çš„åŠŸèƒ½
       # Assert - éªŒè¯ç»“æœ
   ```

### è¿è¡Œæµ‹è¯•çš„æœ€ä½³å®è·µ

1. **å¼€å‘æœŸé—´**ï¼šä½¿ç”¨ `make test-ssh` æˆ– `make test-session` å¿«é€Ÿæµ‹è¯•ç‰¹å®šæ¨¡å—
2. **æäº¤å‰**ï¼šä½¿ç”¨ `make test` ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
3. **è°ƒè¯•æ—¶**ï¼šä½¿ç”¨ `make test-verbose` è·å–è¯¦ç»†è¾“å‡º
4. **CI/CD**ï¼šä½¿ç”¨ `make test-all` è·å–å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š

---

## å…³äºå¼‚æ­¥æµ‹è¯•è­¦å‘Š

å½“å‰æµ‹è¯•ä¸­å‡ºç°çš„ `RuntimeWarning` æ˜¯ç”±äºä½¿ç”¨äº† `unittest` æ¡†æ¶çš„å¼‚æ­¥æµ‹è¯•æ–¹æ³•ã€‚è¿™äº›è­¦å‘Šä¸å½±å“æµ‹è¯•åŠŸèƒ½ï¼Œæ‰€æœ‰æµ‹è¯•éƒ½èƒ½æ­£å¸¸é€šè¿‡ã€‚æœªæ¥å¯ä»¥è€ƒè™‘è¿ç§»åˆ° `pytest-asyncio` æ¥å®Œå…¨æ¶ˆé™¤è¿™äº›è­¦å‘Šã€‚
